<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>World Tower Defense 3D</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
    
    <!-- LOADING SCREEN -->
    <div id="loading-screen" class="screen active">
        <div class="loading-content">
            <div class="loading-logo">
                <div class="logo-3d">ğŸ°</div>
                <h1>World Tower Defense</h1>
                <p class="subtitle">3D Edition</p>
            </div>
            <div class="loading-bar">
                <div class="loading-progress" id="loading-progress"></div>
            </div>
            <p class="loading-text" id="loading-text">Carregando...</p>
        </div>
        <div class="particles" id="particles"></div>
    </div>
    
    <!-- MENU PRINCIPAL -->
    <div id="menu-screen" class="screen">
        <canvas id="menu-canvas"></canvas>
        <div class="menu-overlay">
            <div class="menu-content">
                <div class="menu-logo">
                    <h1>ğŸ° World Tower Defense</h1>
                    <p>3D Edition</p>
                </div>
                
                <div class="player-stats">
                    <div class="stat-box">
                        <span class="stat-icon">ğŸ’</span>
                        <span class="stat-value" id="menu-gems">1000</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-icon">ğŸª™</span>
                        <span class="stat-value" id="menu-coins">5000</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-icon">â­</span>
                        <span class="stat-value">NÃ­vel <span id="menu-level">1</span></span>
                    </div>
                </div>
                
                <div class="menu-buttons">
                    <button class="menu-btn play" onclick="showScreen('mode-screen')">
                        <span class="btn-icon">â–¶ï¸</span>
                        <span>JOGAR</span>
                    </button>
                    <button class="menu-btn" onclick="showScreen('multiplayer-screen')">
                        <span class="btn-icon">ğŸŒ</span>
                        <span>MULTIPLAYER</span>
                    </button>
                    <button class="menu-btn" onclick="showScreen('towers-screen')">
                        <span class="btn-icon">ğŸ°</span>
                        <span>TORRES</span>
                    </button>
                    <button class="menu-btn" onclick="showScreen('shop-screen')">
                        <span class="btn-icon">ğŸ›’</span>
                        <span>LOJA</span>
                    </button>
                    <button class="menu-btn" onclick="showScreen('settings-screen')">
                        <span class="btn-icon">âš™ï¸</span>
                        <span>OPÃ‡Ã•ES</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- SELEÃ‡ÃƒO DE MODO -->
    <div id="mode-screen" class="screen">
        <div class="screen-header">
            <button class="back-btn" onclick="showScreen('menu-screen')">â† Voltar</button>
            <h2>Selecionar Modo</h2>
        </div>
        <div class="cards-container">
            <div class="mode-card" onclick="showScreen('map-screen')">
                <div class="card-icon">ğŸ—ºï¸</div>
                <h3>Campanha</h3>
                <p>50 nÃ­veis Ã©picos</p>
                <div class="card-footer">
                    <div class="progress-mini">
                        <div class="progress-fill" style="width: 30%"></div>
                    </div>
                    <span>15/50</span>
                </div>
            </div>
            <div class="mode-card" onclick="selectMode('endless')">
                <div class="card-icon">â™¾ï¸</div>
                <h3>Infinito</h3>
                <p>Sobreviva o mÃ¡ximo</p>
                <div class="card-footer">
                    <span>ğŸ† Recorde: Wave 47</span>
                </div>
            </div>
            <div class="mode-card" onclick="selectMode('challenge')">
                <div class="card-icon">âš”ï¸</div>
                <h3>Desafio DiÃ¡rio</h3>
                <p>Recompensas especiais</p>
                <div class="card-footer">
                    <span>ğŸ 3 disponÃ­veis</span>
                </div>
            </div>
            <div class="mode-card locked">
                <div class="card-icon">ğŸ‘¹</div>
                <h3>Boss Rush</h3>
                <p>Apenas bosses</p>
                <div class="card-footer">
                    <span>ğŸ”’ NÃ­vel 10</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- SELEÃ‡ÃƒO DE MAPA -->
    <div id="map-screen" class="screen">
        <div class="screen-header">
            <button class="back-btn" onclick="showScreen('mode-screen')">â† Voltar</button>
            <h2>Selecionar Mapa</h2>
        </div>
        <div class="maps-grid">
            <div class="map-card" onclick="selectMap('forest')">
                <div class="map-preview forest"></div>
                <div class="map-info">
                    <h3>ğŸŒ² Floresta</h3>
                    <div class="stars">â­â˜†â˜†</div>
                    <p>Caminho Ãºnico</p>
                </div>
            </div>
            <div class="map-card" onclick="selectMap('desert')">
                <div class="map-preview desert"></div>
                <div class="map-info">
                    <h3>ğŸœï¸ Deserto</h3>
                    <div class="stars">â­â­â˜†</div>
                    <p>Dois caminhos</p>
                </div>
            </div>
            <div class="map-card" onclick="selectMap('volcano')">
                <div class="map-preview volcano"></div>
                <div class="map-info">
                    <h3>ğŸŒ‹ VulcÃ£o</h3>
                    <div class="stars">â­â­â­</div>
                    <p>MÃºltiplos caminhos</p>
                </div>
            </div>
            <div class="map-card locked">
                <div class="map-preview locked"></div>
                <div class="map-info">
                    <h3>â„ï¸ Gelo Eterno</h3>
                    <p>ğŸ”’ Complete VulcÃ£o</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- SELEÃ‡ÃƒO DE DIFICULDADE -->
    <div id="difficulty-screen" class="screen">
        <div class="screen-header">
            <button class="back-btn" onclick="showScreen('map-screen')">â† Voltar</button>
            <h2>Selecionar Dificuldade</h2>
        </div>
        <div class="difficulty-grid">
            <div class="diff-card easy" onclick="startGame('easy')">
                <div class="diff-icon">ğŸ˜Š</div>
                <h3>FÃ¡cil</h3>
                <ul>
                    <li>âœ“ Inimigos lentos</li>
                    <li>âœ“ +50% ouro</li>
                    <li>âœ“ Mais vida</li>
                </ul>
                <div class="diff-reward">ğŸ† x1</div>
            </div>
            <div class="diff-card normal" onclick="startGame('normal')">
                <div class="diff-icon">ğŸ˜</div>
                <h3>Normal</h3>
                <ul>
                    <li>â€¢ Velocidade normal</li>
                    <li>â€¢ Ouro padrÃ£o</li>
                    <li>â€¢ Vida padrÃ£o</li>
                </ul>
                <div class="diff-reward">ğŸ† x2</div>
            </div>
            <div class="diff-card hard" onclick="startGame('hard')">
                <div class="diff-icon">ğŸ˜ˆ</div>
                <h3>DifÃ­cil</h3>
                <ul>
                    <li>âœ— Inimigos rÃ¡pidos</li>
                    <li>âœ— -25% ouro</li>
                    <li>âœ— Menos vida</li>
                </ul>
                <div class="diff-reward">ğŸ† x3</div>
            </div>
            <div class="diff-card nightmare" onclick="startGame('nightmare')">
                <div class="diff-icon">ğŸ’€</div>
                <h3>Pesadelo</h3>
                <ul>
                    <li>â˜  Sem segunda chance</li>
                    <li>â˜  Inimigos com buff</li>
                    <li>â˜  Apenas pros</li>
                </ul>
                <div class="diff-reward">ğŸ† x5</div>
            </div>
        </div>
    </div>
    
    <!-- MULTIPLAYER -->
    <div id="multiplayer-screen" class="screen">
        <div class="screen-header">
            <button class="back-btn" onclick="showScreen('menu-screen')">â† Voltar</button>
            <h2>Multiplayer</h2>
        </div>
        <div class="cards-container">
            <div class="mode-card" onclick="showScreen('lobby-screen')">
                <div class="card-icon">ğŸ®</div>
                <h3>Jogar Online</h3>
                <p>Encontrar partida</p>
                <div class="card-footer">
                    <span>ğŸ‘¥ 1,234 online</span>
                </div>
            </div>
            <div class="mode-card" onclick="createLobby()">
                <div class="card-icon">ğŸ”</div>
                <h3>Sala Privada</h3>
                <p>Jogar com amigos</p>
            </div>
            <div class="mode-card" onclick="showScreen('coop-screen')">
                <div class="card-icon">ğŸ¤</div>
                <h3>Co-op</h3>
                <p>2-4 jogadores</p>
            </div>
            <div class="mode-card" onclick="showScreen('pvp-screen')">
                <div class="card-icon">âš”ï¸</div>
                <h3>PvP</h3>
                <p>1v1 competitivo</p>
            </div>
        </div>
    </div>
    
    <!-- LOBBY -->
    <div id="lobby-screen" class="screen">
        <div class="screen-header">
            <button class="back-btn" onclick="showScreen('multiplayer-screen')">â† Voltar</button>
            <h2>Lobby</h2>
            <div class="lobby-code">CÃ³digo: <span id="lobby-code">ABCD12</span></div>
        </div>
        <div class="lobby-content">
            <div class="lobby-players">
                <div class="player-slot host">
                    <div class="player-avatar">ğŸ‘¤</div>
                    <div class="player-info">
                        <span class="player-name">VocÃª (Host)</span>
                        <span class="player-level">NÃ­vel 15</span>
                    </div>
                    <span class="ready-status ready">âœ…</span>
                </div>
                <div class="player-slot empty">
                    <div class="player-avatar">â•</div>
                    <span>Aguardando jogador...</span>
                </div>
                <div class="player-slot empty">
                    <div class="player-avatar">â•</div>
                    <span>Aguardando jogador...</span>
                </div>
                <div class="player-slot empty">
                    <div class="player-avatar">â•</div>
                    <span>Aguardando jogador...</span>
                </div>
            </div>
            <div class="lobby-settings">
                <h3>âš™ï¸ ConfiguraÃ§Ãµes</h3>
                <div class="setting-row">
                    <span>Mapa</span>
                    <select id="lobby-map">
                        <option>ğŸŒ² Floresta</option>
                        <option>ğŸœï¸ Deserto</option>
                        <option>ğŸŒ‹ VulcÃ£o</option>
                    </select>
                </div>
                <div class="setting-row">
                    <span>Dificuldade</span>
                    <select id="lobby-diff">
                        <option>ğŸ˜Š FÃ¡cil</option>
                        <option>ğŸ˜ Normal</option>
                        <option>ğŸ˜ˆ DifÃ­cil</option>
                    </select>
                </div>
                <div class="setting-row">
                    <span>Waves</span>
                    <select id="lobby-waves">
                        <option>20 Waves</option>
                        <option>50 Waves</option>
                        <option>â™¾ï¸ Infinito</option>
                    </select>
                </div>
            </div>
            <div class="lobby-chat">
                <div class="chat-messages" id="chat-messages">
                    <p class="system-msg">Bem-vindo ao lobby!</p>
                </div>
                <div class="chat-input">
                    <input type="text" placeholder="Digite uma mensagem..." id="chat-input">
                    <button onclick="sendChat()">ğŸ“¤</button>
                </div>
            </div>
        </div>
        <div class="lobby-actions">
            <button class="action-btn ready-btn" onclick="toggleReady()">âœ… Pronto</button>
            <button class="action-btn start-btn" onclick="startMultiplayer()">ğŸ® Iniciar Partida</button>
        </div>
    </div>
    
    <!-- TORRES (ColeÃ§Ã£o) -->
    <div id="towers-screen" class="screen">
        <div class="screen-header">
            <button class="back-btn" onclick="showScreen('menu-screen')">â† Voltar</button>
            <h2>Suas Torres</h2>
        </div>
        <div class="towers-collection">
            <div class="tower-card" onclick="viewTower('archer')">
                <canvas class="tower-preview" id="preview-archer"></canvas>
                <div class="tower-info">
                    <h3>ğŸ¹ Arqueiro</h3>
                    <div class="tower-level">NÃ­vel 5</div>
                    <div class="tower-stats">
                        <span>âš”ï¸ 25</span>
                        <span>ğŸ¯ 5</span>
                        <span>âš¡ 1.0s</span>
                    </div>
                </div>
            </div>
            <div class="tower-card" onclick="viewTower('mage')">
                <canvas class="tower-preview" id="preview-mage"></canvas>
                <div class="tower-info">
                    <h3>ğŸ§™ Mago</h3>
                    <div class="tower-level">NÃ­vel 3</div>
                    <div class="tower-stats">
                        <span>âš”ï¸ 40</span>
                        <span>ğŸ¯ 4</span>
                        <span>âš¡ 1.5s</span>
                    </div>
                </div>
            </div>
            <div class="tower-card" onclick="viewTower('cannon')">
                <canvas class="tower-preview" id="preview-cannon"></canvas>
                <div class="tower-info">
                    <h3>ğŸ’£ CanhÃ£o</h3>
                    <div class="tower-level">NÃ­vel 2</div>
                    <div class="tower-stats">
                        <span>âš”ï¸ 80</span>
                        <span>ğŸ¯ 3</span>
                        <span>âš¡ 2.5s</span>
                    </div>
                </div>
            </div>
            <div class="tower-card locked">
                <div class="tower-preview locked-preview">ğŸ”’</div>
                <div class="tower-info">
                    <h3>âš¡ Tesla</h3>
                    <p>Desbloqueie no NÃ­vel 20</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- LOJA -->
    <div id="shop-screen" class="screen">
        <div class="screen-header">
            <button class="back-btn" onclick="showScreen('menu-screen')">â† Voltar</button>
            <h2>Loja</h2>
            <div class="shop-currency">
                <span>ğŸ’ <span id="shop-gems">1000</span></span>
                <span>ğŸª™ <span id="shop-coins">5000</span></span>
            </div>
        </div>
        <div class="shop-tabs">
            <button class="tab active" onclick="showTab('torres')">Torres</button>
            <button class="tab" onclick="showTab('skins')">Skins</button>
            <button class="tab" onclick="showTab('boosts')">Boosts</button>
            <button class="tab" onclick="showTab('moedas')">Moedas</button>
        </div>
        <div class="shop-grid">
            <div class="shop-item" onclick="buyItem('archer-upgrade')">
                <div class="item-icon">ğŸ¹â¬†ï¸</div>
                <h3>Arqueiro +1</h3>
                <p>Aumenta nÃ­vel mÃ¡ximo</p>
                <button class="buy-btn">ğŸ’ 500</button>
            </div>
            <div class="shop-item" onclick="buyItem('tesla')">
                <div class="item-icon">âš¡</div>
                <h3>Torre Tesla</h3>
                <p>Desbloquear torre</p>
                <button class="buy-btn">ğŸ’ 2000</button>
            </div>
            <div class="shop-item" onclick="buyItem('gold-pack')">
                <div class="item-icon">ğŸª™</div>
                <h3>5000 Moedas</h3>
                <p>Pacote de ouro</p>
                <button class="buy-btn">ğŸ’ 100</button>
            </div>
            <div class="shop-item" onclick="buyItem('double-xp')">
                <div class="item-icon">âœ¨</div>
                <h3>2x XP (1h)</h3>
                <p>Dobra experiÃªncia</p>
                <button class="buy-btn">ğŸ’ 50</button>
            </div>
        </div>
    </div>
    
    <!-- OPÃ‡Ã•ES -->
    <div id="settings-screen" class="screen">
        <div class="screen-header">
            <button class="back-btn" onclick="showScreen('menu-screen')">â† Voltar</button>
            <h2>OpÃ§Ãµes</h2>
        </div>
        <div class="settings-list">
            <div class="settings-section">
                <h3>ğŸ”Š Ãudio</h3>
                <div class="setting-item">
                    <span>MÃºsica</span>
                    <input type="range" min="0" max="100" value="80">
                </div>
                <div class="setting-item">
                    <span>Efeitos Sonoros</span>
                    <input type="range" min="0" max="100" value="100">
                </div>
            </div>
            <div class="settings-section">
                <h3>ğŸ® GrÃ¡ficos</h3>
                <div class="setting-item">
                    <span>Qualidade</span>
                    <select>
                        <option>Baixa</option>
                        <option selected>MÃ©dia</option>
                        <option>Alta</option>
                    </select>
                </div>
                <div class="setting-item">
                    <span>Sombras</span>
                    <label class="toggle">
                        <input type="checkbox" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            <div class="settings-section">
                <h3>ğŸ“± Controles</h3>
                <div class="setting-item">
                    <span>VibraÃ§Ã£o</span>
                    <label class="toggle">
                        <input type="checkbox" checked id="vibration">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <span>Sensibilidade</span>
                    <input type="range" min="1" max="10" value="5">
                </div>
            </div>
        </div>
    </div>
    
    <!-- TELA DO JOGO 3D -->
    <div id="game-screen" class="screen">
        <canvas id="game-canvas"></canvas>
        
        <!-- HUD Superior -->
        <div class="game-hud-top">
            <div class="hud-left">
                <div class="hud-item life">
                    <span>â¤ï¸</span>
                    <div class="hud-bar">
                        <div class="hud-bar-fill" id="life-bar"></div>
                    </div>
                    <span id="life-value">100</span>
                </div>
            </div>
            <div class="hud-center">
                <div class="wave-display">
                    <span class="wave-label">WAVE</span>
                    <span class="wave-number" id="wave-number">1</span>
                </div>
                <div class="enemies-count">
                    ğŸ‘¹ <span id="enemies-count">0</span> restantes
           
